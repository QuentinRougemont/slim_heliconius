// Keywords: migration, dispersal, fitness()
//assumption for genomics:
//mutation rate from Keightley et al: µ= 2.9 × 10−9
//assumed inital r = 1e-08 and rescaled using 1/2*(1-(1-2r)^n)
//assumed Nc = 1e6
//rescale all by a factor of 100
//Size of supergene ~1.5mb on ~300mb so we rescale to a 5kb locus on a 1mb block 

initialize() {
	defineGlobal("MU", 2.9e-7);
	defineGlobal("L", 1e5);  //will be set to 1e7 later
	defineGlobal("R", 9.99999e-07);
	initializeMutationRate(MU);
	initializeMutationType("m1", 0.5, "f", 0.0);
	initializeGenomicElementType("g1", m1, 1.0);
	initializeGenomicElement(g1, 0, L-1);
	initializeRecombinationRate(R);
}
1 {
	//sim.setValue("FST", 0.0);

	subpopCount = 5; 
	for (i in 1:subpopCount)
	sim.addSubpop(i, 5000);
	for (i in 2:subpopCount)
	sim.subpopulations[i-1].setMigrationRates(i-1, 0.01);
	for (i in 1:(subpopCount-1))
	sim.subpopulations[i-1].setMigrationRates(i+1, 0.01);


}
20000 late() {
	//cat("Mean FST at equilibrium: " + (sim.getValue("FST") / 10000) + "\n" );
	het = calcHeterozygosity(p1.genomes);
	pi2 = calcHeterozygosity(p2.genomes);
	pi3 = calcHeterozygosity(p3.genomes);
	pi4 = calcHeterozygosity(p4.genomes);
	pi5 = calcHeterozygosity(p5.genomes);

	cat("pi1 :" +  het + "\n" );
	cat("pi2 :" +  pi2 + "\n" );
	cat("pi3 :" +  pi3 + "\n" );
	cat("pi4 :" +  pi4 + "\n" );
	cat("pi5 :" +  pi5 + "\n" );

	sim.simulationFinished();
}
